<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - Quiz Master</title>
    <link rel="icon" type="image/x-icon" href="https://www.citypng.com/public/uploads/preview/outline-yellow-question-mark-symbol-icon-png-701751694963462wgaiun1p2s.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        /* 1. Global Settings */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            height: 100vh;
            width: 100%;
            /* Cyber Black Background */
            background: radial-gradient(circle at center, #1a1a1a, #000000);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: white;
        }

        /* 2. Main Card (Content) */
        .hero-card {
            background: rgba(15, 15, 15, 0.9);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #00d4ff;
            box-shadow: 0 0 50px rgba(0, 212, 255, 0.2);
            text-align: center;
            width: 90%;
            max-width: 450px;
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 3. 3D Neon Cube (Added Back) */
        .cube-container {
            width: 80px;
            height: 80px;
            margin-bottom: 30px;
            perspective: 400px;
        }
        .cube {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: spin 6s infinite linear;
        }
        .face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #00d4ff;
            font-size: 14px;
        }
        .front  { transform: translateZ(40px); }
        .back   { transform: rotateY(180deg) translateZ(40px); }
        .right  { transform: rotateY(90deg) translateZ(40px); }
        .left   { transform: rotateY(-90deg) translateZ(40px); }
        .top    { transform: rotateX(90deg) translateZ(40px); }
        .bottom { transform: rotateX(-90deg) translateZ(40px); }

        @keyframes spin {
            from { transform: rotateX(0) rotateY(0); }
            to { transform: rotateX(360deg) rotateY(360deg); }
        }

        h1 { color: #fff; font-size: 2.2rem; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0, 212, 255, 0.8); }
        p { color: #aaa; margin-bottom: 30px; }

        .btn-container { width: 100%; display: flex; gap: 15px; }
        .btn { flex: 1; padding: 12px; font-weight: bold; text-decoration: none; border-radius: 50px; text-align: center; transition: 0.3s; text-transform: uppercase; }
        .btn-login { background: #00d4ff; color: black; }
        .btn-register { border: 2px solid #00d4ff; color: #00d4ff; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 0 15px #00d4ff; }

        /* Chatbot Button (Girl Theme) */
        #chat-btn {
            position: fixed; bottom: 30px; right: 30px;
            width: 65px; height: 65px;
            background: #ff69b4;
            border: none; border-radius: 50%;
            font-size: 35px; cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        #chat-window {
            display: none; position: fixed; bottom: 110px; right: 30px;
            width: 320px; height: 450px;
            background: #fff; border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            z-index: 101; flex-direction: column; overflow: hidden;
            border: 2px solid #ff69b4;
        }

        .chat-header {
            background: #ff69b4; color: white; padding: 15px;
            display: flex; justify-content: space-between; align-items: center; font-weight: bold;
        }

        #chat-content { flex: 1; padding: 15px; overflow-y: auto; background: #fffafb; color: black; }

        .chat-input { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .chat-input button { background: #ff69b4; border: none; width: 40px; height: 40px; border-radius: 50%; color: white; cursor: pointer; }

        .message-row { margin-bottom: 10px; display: flex; }
        .user-row { justify-content: flex-end; }
        .ai-row { justify-content: flex-start; }
        .bubble { padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 14px; }
        .user-bubble { background: #00d4ff; color: white; }
        .ai-bubble { background: #ffeef5; color: #d63384; border: 1px solid #ffc1e3; }
    </style>
</head>
<body>

    <div class="hero-card">
        <div class="cube-container">
            <div class="cube">
                <div class="face front">Hey!</div>
                <div class="face back"></div>
                <div class="face right"></div>
                <div class="face left"></div>
                <div class="face top"></div>
                <div class="face bottom"></div>
            </div>
        </div>

        <h1>Quiz Master</h1>
        <p>Welcome to the System.</p>
        <div class="btn-container">
            <a href="/Test/home/" class="btn btn-login">Login</a>
            <a href="/Test/LoginForm/" class="btn btn-register">Register</a>
        </div>
    </div>

    <button id="chat-btn" onclick="toggleChat()">ðŸ‘§</button>

    <div id="chat-window">
        <div class="chat-header">
            <span>ðŸ‘§ Nova (AI)</span>
            <span onclick="toggleChat()" style="cursor: pointer;">âœ–</span>
        </div>
        <div id="chat-content">
            <div class="message-row ai-row">
                <div class="bubble ai-bubble">Hi! I'm Nova ðŸŒ¸. How can I help you today?</div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="user-msg" placeholder="Ask Nova anything..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">âž¤</button>
        </div>
    </div>

<script>
let isWaiting = false;

function toggleChat() {
    const win = document.getElementById('chat-window');
    const btn = document.getElementById('chat-btn');
    if (win.style.display === "none" || win.style.display === "") {
        win.style.display = "flex";
        if(btn) btn.style.display = "none";
    } else {
        win.style.display = "none";
        if(btn) btn.style.display = "flex";
    }
}

function handleEnter(e) {
    if (e.key === 'Enter') sendMessage();
}

function sendMessage() {
    if (isWaiting) return;

    const input = document.getElementById('user-msg');
    const content = document.getElementById('chat-content');
    const msg = input.value.trim();

    if (!msg) return;

    // --- Anti-Spam Check ---
    // Har 3 second mein sirf 1 message jayega taaki 429 error na aaye
    let lastSent = localStorage.getItem('lastChatTime') || 0;
    let now = Date.now();
    if (now - lastSent < 3000) {
        content.innerHTML += `<div class="message-row ai-row"><div class="bubble ai-bubble">Thoda dhire bhai! Nova thak jayegi ðŸŒ¸</div></div>`;
        content.scrollTop = content.scrollHeight;
        return;
    }
    localStorage.setItem('lastChatTime', now);

    isWaiting = true;
    input.disabled = true;

    // 1. User Message Display
    content.innerHTML += `
        <div class="message-row user-row">
            <div class="bubble user-bubble">${msg}</div>
        </div>
    `;
    input.value = "";
    content.scrollTop = content.scrollHeight;

    // 2. Typing Animation (Visual feedback)
    const typingId = "typing-" + Date.now();
    content.innerHTML += `
        <div class="message-row ai-row" id="${typingId}">
            <div class="bubble ai-bubble">Nova is typing... ðŸŒ¸</div>
        </div>
    `;
    content.scrollTop = content.scrollHeight;

    // 3. API Call (Using GET to avoid CSRF 403 Forbidden errors)
    fetch('/Test/chat-api/?msg=' + encodeURIComponent(msg), {
        method: 'GET',
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(res => {
        if (!res.ok) throw new Error('Status ' + res.status);
        return res.json();
    })
    .then(data => {
        document.getElementById(typingId).remove();
        // 4. AI Reply Display
        content.innerHTML += `
            <div class="message-row ai-row">
                <div class="bubble ai-bubble">${data.reply || "Kuch samajh nahi aaya bhai! ðŸŒ¸"}</div>
            </div>
        `;
    })
    .catch((error) => {
        if(document.getElementById(typingId)) document.getElementById(typingId).remove();
        console.error('Error:', error);
        // Quota error handle (Busy message)
        content.innerHTML += `
            <div class="message-row ai-row">
                <div class="bubble ai-bubble">Nova is busy (Quota Limit) ðŸŒ¸. 1 minute ruko!</div>
            </div>
        `;
    })
    .finally(() => {
        isWaiting = false;
        input.disabled = false;
        input.focus();
        content.scrollTop = content.scrollHeight;
    });
}
</script>

</body>
</html>